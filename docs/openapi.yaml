openapi: 3.0.3
info:
  title: Momentum Trading Assistant API
  version: 1.4.1
  description: |
    Fully synced OpenAPI specification for Momentum Trading Assistant.
    Decision-support tool only. Deterministic, server-side logic.
servers:
  - url: https://api.example.com

tags:
  - name: Portfolio
  - name: Positions
  - name: Trades
  - name: Cash
  - name: Signals
  - name: Market
  - name: Health
  - name: Settings

paths:
  /portfolio:
    get:
      tags: [Portfolio]
      summary: Get portfolio overview
      responses:
        '200':
          description: Portfolio overview
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PortfolioOverviewResponse'

  /positions:
    get:
      tags: [Positions]
      summary: Get all open positions
      responses:
        '200':
          description: Positions list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PositionsListResponse'

  /portfolio/position:
    post:
      tags: [Portfolio]
      summary: Add a new position
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddPositionRequest'
      responses:
        '200':
          description: Position created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddPositionResponse'

  /positions/analyze:
    get:
      tags: [Positions]
      summary: Run daily analysis
      responses:
        '200':
          description: Analysis result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisResponse'

  /positions/{position_id}/exit:
    post:
      tags: [Positions]
      summary: Exit a position
      parameters:
        - in: path
          name: position_id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExitPositionRequest'
      responses:
        '200':
          description: Exit result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ExitPositionResponse'

  /trades:
    get:
      tags: [Trades]
      summary: Get trade history
      responses:
        '200':
          description: Trades
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TradeHistoryResponse'

  /cash/transaction:
    post:
      tags: [Cash]
      summary: Record cash transaction
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CashTransactionRequest'
      responses:
        '200':
          description: Cash updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashTransactionResponse'

  /cash/transactions:
    get:
      tags: [Cash]
      summary: List cash transactions
      responses:
        '200':
          description: Transactions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashTransactionsListResponse'

  /cash/summary:
    get:
      tags: [Cash]
      summary: Cash summary
      responses:
        '200':
          description: Cash summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashSummaryResponse'

  /signals/generate:
    post:
      tags: [Signals]
      summary: Generate momentum signals
      parameters:
        - in: query
          name: lookback_days
          schema:
            type: integer
            default: 252
        - in: query
          name: top_n
          schema:
            type: integer
            default: 5
      responses:
        '200':
          description: Signals generated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignalGenerationResponse'

  /signals:
    get:
      tags: [Signals]
      summary: List signals
      parameters:
        - in: query
          name: status
          schema:
            type: string
      responses:
        '200':
          description: Signals
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignalsListResponse'

  /signals/{signal_id}:
    patch:
      tags: [Signals]
      summary: Update signal status
      parameters:
        - in: path
          name: signal_id
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSignalRequest'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateSignalResponse'
    delete:
      tags: [Signals]
      summary: Delete signal
      responses:
        '200':
          description: Deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiOk'

  /market/status:
    get:
      tags: [Market]
      summary: Get market status
      responses:
        '200':
          description: Market status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarketStatusResponse'

  /health:
    get:
      tags: [Health]
      summary: Health check
      responses:
        '200':
          description: Health
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /health/detailed:
    get:
      tags: [Health]
      summary: Detailed health
      responses:
        '200':
          description: Detailed health
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthDetailedResponse'

  /settings:
    get:
      tags: [Settings]
      summary: Get settings
      responses:
        '200':
          description: Settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SettingsResponse'

components:
  schemas:
    ApiOk:
      type: object
      properties:
        status:
          type: string
          example: ok

    ApiError:
      type: object
      properties:
        status:
          type: string
          example: error
        message:
          type: string

    PriceDual:
      type: object
      properties:
        gbp:
          type: number
          format: float
        native:
          type: number
          format: float

    PositionListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        ticker:
          type: string
        market:
          type: string
          enum: [US, UK]
        entry_date:
          type: string
          format: date
        entry_price:
          $ref: '#/components/schemas/PriceDual'
        shares:
          type: number
        current_price:
          $ref: '#/components/schemas/PriceDual'
        stop_price:
          $ref: '#/components/schemas/PriceDual'
        pnl:
          type: number
        pnl_percent:
          type: number
        holding_days:
          type: integer
        status:
          type: string

    PortfolioOverviewResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object
              properties:
                cash:
                  type: number
                cash_balance:
                  type: number
                total_value:
                  type: number
                open_positions_value:
                  type: number
                total_pnl:
                  type: number
                initial_value:
                  type: number
                net_deposits:
                  type: number
                live_fx_rate:
                  type: number
                last_updated:
                  type: string
                  format: date-time
                positions:
                  type: array
                  items:
                    $ref: '#/components/schemas/PositionListItem'

    PositionsListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/PositionListItem'

    AddPositionRequest:
      type: object
      required: [ticker, entry_date, shares, entry_price]
      properties:
        ticker:
          type: string
        market:
          type: string
          enum: [US, UK]
        entry_date:
          type: string
          format: date
        shares:
          type: number
        entry_price:
          type: number
        fx_rate:
          type: number
          nullable: true
        atr_value:
          type: number
          nullable: true
        stop_price:
          type: number
          nullable: true
        entry_note:
          type: string
          nullable: true
        tags:
          type: array
          items:
            type: string

    AddPositionResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object
              properties:
                ticker:
                  type: string
                total_cost:
                  type: number
                fees_paid:
                  type: number
                entry_price:
                  type: number
                initial_stop:
                  type: number
                remaining_cash:
                  type: number

    AnalysisResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object
              properties:
                analysis_date:
                  type: string
                  format: date
                summary:
                  type: object
                actions:
                  type: array
                  items:
                    type: object

    ExitPositionRequest:
      type: object
      required: [exit_price]
      properties:
        shares:
          type: number
          nullable: true
        exit_price:
          type: number
        exit_date:
          type: string
          format: date
        exit_reason:
          type: string
        exit_fx_rate:
          type: number
          nullable: true
        exit_note:
          type: string
          nullable: true

    ExitPositionResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object

    TradeHistoryResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object

    CashTransactionRequest:
      type: object
      required: [type, amount]
      properties:
        type:
          type: string
          enum: [deposit, withdrawal]
        amount:
          type: number
        date:
          type: string
          format: date
        note:
          type: string

    CashTransactionResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object

    CashTransactionsListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: array
              items:
                type: object

    CashSummaryResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object

    SignalGenerationResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object

    SignalsListResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: array
              items:
                type: object

    UpdateSignalRequest:
      type: object
      required: [status]
      properties:
        status:
          type: string

    UpdateSignalResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object

    MarketStatusResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: object

    HealthResponse:
      type: object
      properties:
        status:
          type: string
        timestamp:
          type: string
          format: date-time
        version:
          type: string

    HealthDetailedResponse:
      type: object
      properties:
        status:
          type: string
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        checks:
          type: object

    SettingsResponse:
      allOf:
        - $ref: '#/components/schemas/ApiOk'
        - type: object
          properties:
            data:
              type: array
              items:
                type: object
