# Production Strategy – Momentum Trading System

**Owner:** Strategy Rules & System Intent Owner  
**Status:** Canonical  
**Version:** 1.2  
**Last updated:** 18 February 2026  
**Applies to:** Production backtests, live system, and documentation  

---

## Change log

| Version | Date | Summary |
|---|---|---|
| 1.3 | 19 February 2026 | Revised §4.1.7 — replaced toggle activation model with always-visible widget model per pre-alignment decision record for roadmap item 3.2 (Decision 3). No changes to calculation rules, validity rules, FX handling, or cash constraint behaviour in §4.1.1–§4.1.6. |
| 1.2 | 18 February 2026 | Added canonical rules for the Position Sizing Calculator (Section 4.1). No changes to stop-loss, trailing logic, or exit conditions. |
| 1.1 | 18 February 2026 | Expanded system boundaries and design rationale (Section 13). No behavioural rules changed. |
| 1.0 | February 2026 | Initial canonical version. |

---

## 1. Purpose

This document defines the authoritative production strategy for the Momentum Trading System.

It is a behavioural contract between:
- strategy intent
- system implementation
- backtests and reported performance

If a behaviour can affect trading outcomes, it must be specified here. If there is any conflict between this document and the code, user interface, analytics, or user interpretation, this document prevails.

---

## 2. Strategy intent (non-negotiable)

The strategy is designed to:

1. Capture medium- to long-term momentum trends.  
2. Avoid premature exits caused by early volatility.  
3. Give losing trades time to resolve.  
4. Defend profits aggressively once momentum is confirmed.  
5. Enforce asymmetric risk: losses are tolerated; gains are defended.

These principles define the strategy’s intent and must remain stable over time.

---

## 3. Human-in-the-loop execution model

- Entries and exits are executed manually by the user.  
- Exit signals generated by the system are recommendations, not automatic orders.  
- The system provides decision support only and does not execute trades.

This is a deliberate design constraint.

---

## 4. Position entry rules

Positions are entered manually via the web interface.

**Required at entry:**
- ticker symbol  
- entry date  
- entry price  
- number of shares (fractional shares supported)  
- ATR value (used to calculate the stop at entry)

Fees are applied automatically based on market (UK / US).

---

## 4.1 Position Sizing Calculator (decision support) — canonical rules

This section defines the canonical, deterministic behaviour for the Position Sizing Calculator used during position entry.

- The calculator proposes a share quantity only.  
- It does not change the entry, stop, or exit rules.  
- All sizing calculations are performed on the backend and are authoritative.

### 4.1.1 Definitions

**Entry price**  
The user-entered entry price in the instrument’s native currency.

**Stop price**  
The stop price used for sizing. This is the entry-time initial stop for the prospective position, in the instrument’s native currency.

**Stop distance**  
The difference between Entry price and Stop price, in the instrument’s native currency.

```text
StopDistance = EntryPrice - StopPrice
```

**Portfolio value (GBP)**  
The portfolio value used for sizing. This is the most recent stored snapshot value:

```text
latest portfolio_history.total_value
```

**Available cash (GBP)**  
Cash available to allocate to a new position:

```text
portfolios.cash
```

### 4.1.2 Risk basis (canonical)

Risk is budgeted at the portfolio level.

```text
RiskAmount = PortfolioValue * RiskPercent
```

Available cash is an execution feasibility constraint and must not be used as the risk basis.

### 4.1.3 Share calculation (canonical)

```text
RawShares = RiskAmount / StopDistance
```

**Rounding and precision**
- Shares are returned to 4 decimal places.  
- Rounding is conservative to avoid exceeding the intended risk.

```text
SuggestedShares = floor(RawShares, 4dp)
```

The user interface may display shares to 2 decimal places for readability. The backend value remains 4 decimal places.

### 4.1.4 Validity rules (deterministic constraints)

The sizing result is **invalid** if any of the following are true:

- `RiskPercent <= 0`  
- `PortfolioValue <= 0`  
- `EntryPrice <= 0`  
- `StopPrice <= 0`  
- `StopDistance <= 0` (including `StopPrice >= EntryPrice`)

If invalid:
- the system must not apply `SuggestedShares`, and  
- the backend must return a deterministic invalid reason code.

If the portfolio value snapshot is missing, the backend must return an invalid result with reason code `NO_PORTFOLIO_VALUE_SNAPSHOT`.

### 4.1.5 Currency and FX handling (canonical)

- Entry price and Stop price are in the instrument’s native currency.  
- Portfolio value and Available cash are in GBP.

If conversion is required:
- the system uses an effective FX rate,  
- the default is the system-provided live FX rate, and  
- a user-provided FX rate overrides the live rate.

The FX rate used must be returned in the sizing response for auditability.

### 4.1.6 Cash constraint (execution feasibility gate)

The calculator must not apply a share count that exceeds Available cash.

```text
EstimatedCost = (SuggestedShares * EntryPrice) + EstimatedFees
```

If:

```text
EstimatedCost > AvailableCash
```

then:

```text
Result = INSUFFICIENT_CASH
```

In this case:
- shares must not be auto-filled, and  
- the result may include `MaxAffordableShares` for user interface messaging.

### 4.1.7 User interface interaction requirement

- The Position Sizing Calculator is always visible within the Position Entry form. It does not require activation via a toggle or any other user action.

**Calculation behaviour**

- The calculator recalculates automatically as the user enters or modifies entry_price, stop_price, or risk_percent.
- Recalculation is debounced: the backend call is made 300ms after the user stops typing.
- A loading state is shown during the window between the debounce firing and the response returning.
- All sizing calculations are performed on the backend and are authoritative.

**Auto-fill behaviour**

- When a valid result is returned and the shares field is empty: the shares field is auto-filled with SuggestedShares.
- When a valid result is returned and the user has already manually entered a share count: the shares field is not overwritten. The suggested value is displayed alongside the field with an explicit "use this" affordance, allowing the user to apply it deliberately.
- When the result is INSUFFICIENT_CASH: the shares field is not auto-filled. MaxAffordableShares is shown as informational context only.
- When the result is invalid: the shares field is not auto-filled. An inline plain-language message is shown beneath the widget.

**Form submission**

- An invalid or cash-constrained sizing result does not block form submission.
- The user may enter shares manually and proceed regardless of widget state.
- The sizing calculator is decision support; it is not a submission gate.

**Rationale for change from v1.2**

The toggle model specified in v1.2 was written before the pre-alignment meeting for roadmap item 3.2. During that meeting, the Head of UX & Design and Product Owner agreed that the calculator should be always visible in the entry form — requiring users to discover and activate a toggle would reduce the daily workflow value that justifies the feature. The auto-fill protection rule (do not overwrite a manually entered value) is a financial safety constraint: silently replacing a user-entered share count could cause an unintended position size to be submitted. Full decision rationale: docs/product/decisions/3.2-position-sizing-calculator.md Decision 3.
---

## 5. Initial stop calculation

At entry, an initial protective stop is calculated:

```text
InitialStop = EntryPrice - (InitialATRMultiplier * ATR)
```

**Rules**
- The stop exists immediately.  
- The stop is stored and tracked from day one.  
- The stop is not enforced during the grace period.

**Purpose**
- to make downside risk visible  
- to anchor trailing stop logic  
- to reduce reactive decision-making

---

## 6. Grace period

### 6.1 Definition
A fixed grace period applies to all new positions.

### 6.2 Current production configuration
Grace period length: **10 calendar days** (days 0–9 inclusive)

### 6.3 Behaviour during the grace period
- Stop-loss enforcement is disabled.  
- The stop price is calculated and stored.  
- No stop-based exit recommendation may be generated.  
- Manual exit is always permitted.

### 6.4 Rationale
The grace period reduces the likelihood of exits caused by normal post-entry volatility rather than a breakdown of the trade thesis.

---

## 7. Trailing stop-loss framework (post-grace)

After the grace period, the position enters active risk management.

### 7.1 ATR framework
- ATR period: 14 days (rolling)  
- ATR is recalculated daily.

### 7.2 Profit-aware stop logic

**Losing or breakeven positions**
```text
Stop = CurrentPrice - (InitialATRMultiplier * ATR)
```
- Wide stop intended to allow recovery.  
- Reduces noise-driven exits.

**Profitable positions**
```text
Stop = CurrentPrice - (ProfitATRMultiplier * ATR)
```
- Tight trailing stop intended to lock in gains.  
- Reduces drawdowns on winning positions.

### 7.3 Stop movement rule (hard constraint)

```text
UpdatedStop = max(CurrentStop, NewlyCalculatedStop)
```

Stops must never move downwards. Once tightened, a stop must not be loosened. This rule is absolute.

---

## 8. Exit conditions

A position may exit under exactly three conditions.

### 8.1 Stop-loss trigger
- Active only after the grace period.  
- Triggered when the market price breaches the trailing stop.  
- Exit is recommended and requires manual confirmation.

### 8.2 Market risk-off override
- Positions are exited when the relevant market enters a risk-off regime.  
- The regime is defined by the 200-day moving average of the relevant index.  
- This applies regardless of stop position.

### 8.3 Manual exit
- User-initiated.  
- Available at any time.

---

## 9. Position states

Each position exists in exactly one state at any time.

| State | Definition |
|---|---|
| GRACE | Days 0–9, stop inactive |
| LOSING | Post-grace, P&L ≤ 0, wide stop |
| PROFITABLE | Post-grace, P&L > 0, tight stop |
| EXITED | Position closed |

States are mutually exclusive and deterministic.

---

## 10. Risk management summary

**Position-level**
- Fixed grace period.  
- Wide stops while losing.  
- Tight stops once profitable.  
- Stops only tighten.

**Portfolio-level**
- Market regime override.  
- Currency-aware P&L.  
- Cash-flow-adjusted performance tracking.

---

## 11. Current production parameters

- Grace period: 10 days  
- Initial / losing stop multiplier: 5 × ATR  
- Profitable stop multiplier: 2 × ATR  
- ATR period: 14 days  

These parameters must be consistent across production backtests, live system logic, and reported performance metrics.

---

## 12. Parameter governance

The values above are parameters, not immutable rules. They describe how the strategy currently expresses its intent.

### 12.1 Stable elements
- A grace period exists.  
- Losses and profits are treated asymmetrically.  
- Profits are defended once momentum is confirmed.  
- Stops do not loosen.

### 12.2 Elements that may change
- Grace period length.  
- ATR multipliers.  
- ATR lookback period.

### 12.3 Change control requirements

Any parameter change must:
- be explicitly documented  
- be versioned at the strategy level  
- state the rationale and expected impact  
- acknowledge loss of direct comparability with prior results  
- be applied consistently across backtests, live logic, and documentation  

Until a change is made, the listed parameters define canonical production behaviour.

---

## 13. System boundaries

### 13.1 This system is
- a deterministic decision-support engine  
- a risk-managed momentum framework  
- a single, explicit, human-designed strategy  
- human-in-the-loop by design

### 13.2 This system is not
- an automated trading bot  
- a broker execution engine  
- a discretionary or adaptive rule system  
- a multi-strategy or configurable strategy platform  
- a machine-learning or AI-driven prediction system  
- an options or futures trading system  
- a real-time streaming or execution system

### 13.3 Design boundary rationale

Human-in-the-loop execution is a design principle, not a limitation.

Gap risk monitoring is excluded by design because the system operates on a daily decision cadence and cannot act on gaps at the moment they occur. Exposing a gap risk metric would increase noise without enabling a decision.

The strategy is fixed and explicit. A strategy builder, adaptive rules engine, or machine learning-based signal generation would change the nature of the system and is outside the design intent.

---

## 14. Authority statement

This document is the single source of truth for production strategy behaviour.

If a discrepancy exists between code, user interface behaviour, analytics, or user interpretation, this document prevails.

**Guiding principle**  
If a rule can change outcomes, it must be explicit, intentional, and owned.
