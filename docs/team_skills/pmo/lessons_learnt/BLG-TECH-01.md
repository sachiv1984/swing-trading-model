# Lessons Learnt — BLG-TECH-01: Sharpe Variance + Capital Efficiency

**Item:** BLG-TECH-01 — Fix Sharpe Variance Method + Capital Efficiency Currency Basis
**Type:** Tech Backlog (P0 — Metrics Correctness)
**Closed:** 2026-02-21
**Reviewed by:** PMO Lead
**Date filed:** 2026-02-21

> **Note on template applicability:** The standard lessons learnt template is triggered by a scope document being committed. BLG-TECH-01 had no pre-alignment phase and no scope document — it was a quality gate item resolved directly against the canonical spec. This record uses an adapted version of the template structure. The process gap (no lessons learnt process for tech backlog items) is itself a finding — see Section 4 below.

---

## What worked well

- Once the item was prioritised as a v1.6 quality gate, resolution was fast — the canonical spec was clear, the fix was unambiguous, and sign-off was granted on the same day.
- Having `metrics_definitions.md` as an explicit canonical source meant there was no debate about what "correct" looked like. The spec was authoritative and the fix was deterministic.
- The Metrics Definitions owner sign-off requirement (from the backlog acceptance criteria) was the right gate — it ensured expected values were confirmed against the canonical formula, not just against a re-run of the code.

---

## What created friction

### Issue 1 — The validation system couldn't detect the errors it was supposed to catch
**Root cause: Expected values derived from the implementation, not from the canonical spec**

This is the most important finding of this review. The validation system in `validation_data.py` was calibrated against the existing (incorrect) implementation, not against the canonical formula in `metrics_definitions.md`. This meant the system validated *internal consistency*, not *correctness*. A P0 error could pass validation indefinitely.

**Specifically:**
- Capital efficiency expected value was `0.17` — calculated using `entry_price × shares` (the incorrect method). The implementation returned `0.17`. The validation passed. The answer was wrong.
- Sharpe expected value was `0.00` due to insufficient data (fewer than 10 trades and 30 snapshots). This happened to match regardless of variance method. The validation gave false confidence.
- Capital efficiency was not even in `EXPECTED_METRICS` at all. The metric was returned by the API, reported to users, but never validated. The metric count was 12, not 13. A metric could be completely wrong and the validation system would never fire.

**Why this happened:** When the validation system was built, expected values were likely generated by running the existing code against the test portfolio — a natural shortcut. But this permanently coupled the expected values to the implementation's mistakes. The validation system's glossary even defines "Expected Value" as "Ground truth metric calculated manually from test portfolio" — which implies independence — but the actual practice was not independent.

**Impact:** The validation system presented a false picture of correctness for the duration of v1.5 and the early stages of v1.6. Both the Sharpe and capital efficiency errors were in production, passing validation, while being reported to users.

---

### Issue 2 — Known deviations documented without triage
**Root cause: No mandatory triage rule for spec deviations**

Both errors were identified and documented before BLG-TECH-01 was created:
- `analytics_endpoints.md` "Known limitations" section listed both Sharpe variance and capital efficiency currency basis as explicit deviations
- `metrics_definitions.md` Appendix E recorded both as "Backlog Items" with the canonical requirement and a corrective action

But the documentation did not include: a priority tier, a target release, or a named owner. The governance model for known deviations was "document it and create a backlog item" — not "classify it, own it, and give it a ship date."

P0 correctness issues should not be documented as passive backlog items. The act of documenting a deviation should trigger an explicit triage decision. For P0 deviations, that decision must result in a target release being assigned at the time of documentation — not deferred until someone notices the item is unresolved.

**Impact:** Both errors sat as known deviations across the full lifecycle of v1.5 without a forced resolution path. They were fixed as a quality gate for v1.6 — but only because someone made that explicit prioritisation decision. Without it they could have drifted further.

---

### Issue 3 — No lessons learnt process for tech backlog items
**Root cause: Template gap in PMO process**

The standard lessons learnt template requires a scope document as its trigger. BLG-TECH-01 had no scope document and no pre-alignment phase. As a result, there was no automatic prompt to run a lessons learnt review on this item — the review is only happening now because it was raised explicitly.

Tech backlog items — particularly P0 and P1 correctness or governance issues — often carry the most systemic lessons precisely because they represent failures that reached production. They deserve a review process of their own.

---

## Process improvements actioned

### 1. Expected value independence rule added to `validation_system.md`
**Template/document updated:** `docs/operations/validation_system.md`
**Version bump:** 1.0.1 → 1.0.2
**Change:** New rule added to the "Updating Expected Values" section: expected values in `validation_data.py` must be independently hand-calculated from `metrics_definitions.md` against the `VALIDATION_TRADES` dataset — they must never be derived by running the existing implementation. A comment block template added for each expected value documenting: the canonical formula reference, the manual calculation method, and the date last verified. This rule exists to prevent the validation system from masking implementation errors by being calibrated against them.

### 2. Validation coverage completeness rule added to `validation_system.md`
**Template/document updated:** `docs/operations/validation_system.md`
**Version bump:** 1.0.2 (same PR as above)
**Change:** New rule added to the "Adding New Metrics" section: every metric returned by `GET /analytics/metrics` must have a corresponding entry in `EXPECTED_METRICS`. Adding a metric to the API response without adding it to validation is a governance violation. The Metrics Definitions owner must confirm the expected value and sign off before the metric is considered validated.

### 3. Known deviation triage rule added to `docs/governance/document_lifecycle_guide.md`
**Document updated:** `docs/governance/document_lifecycle_guide.md`
**Version bump:** 2.1 → 2.2
**Change:** New section added: "Known Deviation Documentation Standard." When any canonical spec owner documents a deviation from canonical behaviour (as a "known limitation", "backlog item", or equivalent), they must record at the time of documentation: the severity tier (P0/P1/P2/P3), a target resolution release, and a named owner. P0 deviations must be resolved within one release cycle of being documented. The Head of Specs Team is responsible for enforcing this rule at the governance review trigger points defined in §8.

### 4. Lightweight tech backlog lessons learnt process added
**New file:** `docs/team_skills/pmo/processess/tech_backlog_lessons_learnt.md`
**Version:** 1.0
**Change:** A lightweight variant of the lessons learnt template specifically for tech backlog items (P0/P1) that ship without a formal pre-alignment phase. Covers: how the issue arose, how it was detected (or why it wasn't detected sooner), whether the fix was unambiguous, and what process change prevents recurrence. Filed at `docs/product/lessons_learnt/{blg-id}-lessons.md`.

---

## New skills or templates created

- `docs/team_skills/pmo/processess/tech_backlog_lessons_learnt.md` (v1.0) — lightweight lessons learnt template for P0/P1 tech backlog items

---

## Outstanding actions

| Action | Owner | Target |
|--------|-------|--------|
| Apply `validation_system.md` v1.0.2 — expected value independence and coverage completeness rules | Infrastructure & Operations Documentation Owner + Engineering | Before BLG-TECH-02 implementation begins |
| Apply `document_lifecycle_guide.md` v2.2 — known deviation triage rule | Head of Specs Team | Before v1.6.1 pre-alignment opens |
| Audit existing known limitations in `analytics_endpoints.md` for the remaining item (`total_return_pct` — unimplemented, no portfolio_id filter) — apply triage rule retrospectively | API Contracts & Documentation Owner | Before v1.6.1 exits |
| Confirm all current `EXPECTED_METRICS` values in `validation_data.py` have been independently verified against `metrics_definitions.md` — document calculation method for each | Engineering + Metrics Definitions owner | Before v1.6 ships to production |